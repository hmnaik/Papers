<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
<title>Documentation - Point Cloud Library (PCL)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Fast Point Feature Histograms (FPFH) descriptors</title><link rel="stylesheet" href="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/sphinxdoc.css" type="text/css"><link rel="stylesheet" href="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/pygments.css" type="text/css"><script src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.php',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/jquery.js"></script><script type="text/javascript" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/underscore.js"></script><script type="text/javascript" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/doctools.js"></script><link rel="top" title="None" href="http://pointclouds.org/documentation/tutorials/index.php"><meta charset="utf-8"><title> - Point Cloud Library (PCL)</title><link rel="stylesheet" type="text/css" media="screen, projection" href="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/index.css"></head>





  
    
    
    
    
    
    
    
    
    
    
    
    






<!--[[+feed:notempty=`<link rel="alternate" type="application/atom+xml" href="" title="[[+feedtitle]]">-->


<body id="pointclouds-org">

<div id="wrapper">

<div id="menu-bar">

<a href="http://pointclouds.org/" id="pcl-logo">Point Cloud Library</a>
<!--a href="http://www.openperception.org" id="op-logo">Open Perception</a-->

<ul class="menus-level0"><li>
<a href="http://pointclouds.org/about/" accesskey="1">About</a>

</li><li>
<a href="http://pointclouds.org/news/" accesskey="2" title="News Articles">News</a>

</li><li>
<a href="http://pointclouds.org/blog/" accesskey="3">Blog</a>

</li><li>
<a href="http://pointclouds.org/downloads/" accesskey="4">Downloads</a>

</li><li>
<a href="http://pointclouds.org/media/" accesskey="5">Media</a>

</li><li class="active">
<a href="http://pointclouds.org/documentation/" accesskey="6">Documentation</a>

</li><li>
<a href="http://pointclouds.org/jobs/" accesskey="7" title="Job Opportunities">Jobs</a>

</li><li>
<a href="http://pointclouds.org/contact.html" accesskey="8">Contact</a>

</li></ul>
<ul class="menus-level1"><li>
<a href="http://pointclouds.org/documentation/tutorials/index.php" accesskey="q" title="PCL Tutorials">Tutorials</a>

</li><li>
<a href="http://pointclouds.org/documentation/advanced/index.php" accesskey="w" title="Advanced Topics">Advanced</a>

</li></ul>
</div> <!-- #menu-bar -->
<div id="pagetitle">
<h1>Documentation</h1>
<a id="donate" href="http://www.openperception.org/support/"><img src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/donate-button.png" alt="Donate to the Open Perception foundation"></a>
</div>
<div id="page-content">

  
  

    <div class="document">
      <div class="documentwrapper">
          <div>
            
  <div class="section" id="fast-point-feature-histograms-fpfh-descriptors">
<span id="fpfh-estimation"></span><h1>Fast Point Feature Histograms (FPFH) descriptors</h1>
<p>The theoretical computational complexity of the Point Feature Histogram (see
<a class="reference internal" href="http://pointclouds.org/documentation/tutorials/pfh_estimation.php#pfh-estimation"><em>Point Feature Histograms (PFH) descriptors</em></a>) for a given point cloud <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/4b4cade9ca8a2c8311fafcf040bc5b15ca507f52.png" alt="P"> with <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/174fadd07fd54c9afe288e96558c92e0c1da733a.png" alt="n"> points
is <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/a220226b01b60a4dcacb03fb474c667999e556c6.png" alt="O(nk^2)">, where <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/8c325612684d41304b9751c175df7bcc0f61f64f.png" alt="k"> is the number of neighbors for each point
<img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/36f73fc1312ee0349b3f3a0f3bd9eb5504339011.png" alt="p"> in <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/4b4cade9ca8a2c8311fafcf040bc5b15ca507f52.png" alt="P">. For real-time or near real-time applications, the
computation of Point Feature Histograms in dense point neighborhoods can
represent one of the major bottlenecks.</p>
<p>This tutorial describes a simplification of the PFH formulation, called Fast
Point Feature Histograms (FPFH) (see <a class="reference internal" href="http://pointclouds.org/documentation/tutorials/how_features_work.php#rusudissertation">[RusuDissertation]</a> for more information),
that reduces the computational complexity of the algorithm to <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/fd3932c9dae67378078c800c03c40c981457778c.png" alt="O(nk)">,
while still retaining most of the discriminative power of the PFH.</p>
</div>
<div class="section" id="theoretical-primer">
<h1>Theoretical primer</h1>
<p>To simplify the histogram feature computation, we proceed as follows:</p>
<blockquote>
<div><ul class="simple">
<li>in a first step, for each query point <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q"> a set of tuples
<img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/b74d7e1bdb055bd9781f7244f0154b01313ed754.png" alt="\alpha, \phi, \theta"> between itself and its neighbors are computed
as described in <a class="reference internal" href="http://pointclouds.org/documentation/tutorials/pfh_estimation.php#pfh-estimation"><em>Point Feature Histograms (PFH) descriptors</em></a> - this will be called the Simplified
Point Feature Histogram (SPFH);</li>
<li>in a second step, for each point its k neighbors are re-determined, and the
neighboring SPFH values are used to weight the final histogram of pq
(called FPFH) as follows:</li>
</ul>
</div></blockquote>
<div class="math">
<p><img src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/50797a25fc61a594115271ae0e914b6576c01672.png" alt="FPFH(\boldsymbol{p}_q) = SPFH(\boldsymbol{p}_q) + {1 \over k} \sum_{i=1}^k {{1 \over \omega_k} \cdot SPFH(\boldsymbol{p}_k)}"></p>
</div><p>where the weight <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ff9c62c564e81a783cedf3176ff0d8859b540d08.png" alt="\omega_k"> represents a distance between the query point
<img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q"> and a neighbor point <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/4508393135451dc6c41b01f36072dd16674586bc.png" alt="p_k"> in some given metric space, thus
scoring the (<img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/a20b64aa1f8b7bcb69b0c828bfa12a20a7a4cab2.png" alt="p_q, p_k">) pair, but could just as well be selected as a
different measure if necessary.  To understand the importance of this weighting
scheme, the figure below presents the influence region diagram for a
k-neighborhood set centered at <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q">.</p>
<img alt="_images/fpfh_diagram.png" class="align-center" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/fpfh_diagram.png">
<p>Thus, for a given query point <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q">, the algorithm first estimates its
SPFH values by creating pairs between itself and its neighbors (illustrated
using red lines). This is repeated for all the points in the dataset, followed
by a re-weighting of the SPFH values of pq using the SPFH values of its
<img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/4508393135451dc6c41b01f36072dd16674586bc.png" alt="p_k"> neighbors, thus creating the FPFH for <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q">. The extra FPFH
connections, resultant due to the additional weighting scheme, are shown with
black lines. As the diagram shows, some of the value pairs will be counted
twice (marked with thicker lines in the figure).</p>
</div>
<div class="section" id="differences-between-pfh-and-fpfh">
<h1>Differences between PFH and FPFH</h1>
<p>The main differences between the PFH and FPFH formulations are summarized below:</p>
<blockquote>
<div><ol class="arabic simple">
<li>the FPFH does not fully interconnect all neighbors of <img class="math" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/ec1b25174234d220dc2dd15100563cc5a4b1c0eb.png" alt="p_q"> as it
can be seen from the figure, and is thus missing some value pairs which
might contribute to capture the geometry around the query point;</li>
<li>the PFH models a precisely determined surface around the query point,
while the FPFH includes additional point pairs outside the <strong>r</strong> radius
sphere (though at most <strong>2r</strong> away);</li>
<li>because of the re-weighting scheme, the FPFH combines SPFH values and
recaptures some of the point neighboring value pairs;</li>
<li>the overall complexity of FPFH is greatly reduced, thus making possible to
use it in real-time applications;</li>
<li>the resultant histogram is simplified by decorrelating the values, that is
simply creating <em>d</em> separate feature histograms, one for each feature
dimension, and concatenate them together (see figure below).</li>
</ol>
</div></blockquote>
<img alt="_images/fpfh_theory.jpg" class="align-center" src="Documentation_FPFH_Point%20Cloud%20Library%20%28PCL%29_files/fpfh_theory.jpg">
</div>
<div class="section" id="estimating-fpfh-features">
<h1>Estimating FPFH features</h1>
<p>Fast Point Feature Histograms are implemented in PCL as part of the
<a class="reference external" href="http://docs.pointclouds.org/trunk/group__features.html">pcl_features</a>
library.</p>
<p>The default FPFH implementation uses 11 binning subdivisions (e.g., each of the
four feature values will use this many bins from its value interval), and a
decorrelated scheme (see above: the feature histograms are computed separately
and concantenated) which results in a 33-byte array of float values. These are
stored in a <strong>pcl::FPFHSignature33</strong> point type.</p>
<p>The following code snippet will estimate a set of FPFH features for all the
points in the input dataset.</p>
<div class="highlight-cpp"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;pcl/point_types.h&gt;</span>
<span class="cp">#include &lt;pcl/features/fpfh.h&gt;</span>

<span class="p">{</span>
  <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">cloud</span> <span class="p">(</span><span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">Normal</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">normals</span> <span class="p">(</span><span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">Normal</span><span class="o">&gt;</span> <span class="p">());</span>

  <span class="p">...</span> <span class="n">read</span><span class="p">,</span> <span class="n">pass</span> <span class="n">in</span> <span class="n">or</span> <span class="n">create</span> <span class="n">a</span> <span class="n">point</span> <span class="n">cloud</span> <span class="n">with</span> <span class="n">normals</span> <span class="p">...</span>
  <span class="p">...</span> <span class="p">(</span><span class="nl">note:</span> <span class="n">you</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">single</span> <span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">PointNormal</span><span class="o">&gt;</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span><span class="p">)</span> <span class="p">...</span>

  <span class="c1">// Create the FPFH estimation class, and pass the input dataset+normals to it</span>
  <span class="n">pcl</span><span class="o">::</span><span class="n">FPFHEstimation</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="p">,</span> <span class="n">pcl</span><span class="o">::</span><span class="n">Normal</span><span class="p">,</span> <span class="n">pcl</span><span class="o">::</span><span class="n">FPFHSignature33</span><span class="o">&gt;</span> <span class="n">fpfh</span><span class="p">;</span>
  <span class="n">fpfh</span><span class="p">.</span><span class="n">setInputCloud</span> <span class="p">(</span><span class="n">cloud</span><span class="p">);</span>
  <span class="n">fpfh</span><span class="p">.</span><span class="n">setInputNormals</span> <span class="p">(</span><span class="n">normals</span><span class="p">);</span>
  <span class="c1">// alternatively, if cloud is of tpe PointNormal, do fpfh.setInputNormals (cloud);</span>

  <span class="c1">// Create an empty kdtree representation, and pass it to the FPFH estimation object.</span>
  <span class="c1">// Its content will be filled inside the object, based on the given input dataset (as no other search surface is given).</span>
  <span class="n">pcl</span><span class="o">::</span><span class="n">search</span><span class="o">::</span><span class="n">KdTree</span><span class="o">&lt;</span><span class="n">PointXYZ</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">tree</span> <span class="p">(</span><span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">search</span><span class="o">::</span><span class="n">KdTree</span><span class="o">&lt;</span><span class="n">PointXYZ</span><span class="o">&gt;</span><span class="p">);</span>

  <span class="n">fpfh</span><span class="p">.</span><span class="n">setSearchMethod</span> <span class="p">(</span><span class="n">tree</span><span class="p">);</span>

  <span class="c1">// Output datasets</span>
  <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">FPFHSignature33</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">fpfhs</span> <span class="p">(</span><span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">FPFHSignature33</span><span class="o">&gt;</span> <span class="p">());</span>

  <span class="c1">// Use all neighbors in a sphere of radius 5cm</span>
  <span class="c1">// IMPORTANT: the radius used here has to be larger than the radius used to estimate the surface normals!!!</span>
  <span class="n">fpfh</span><span class="p">.</span><span class="n">setRadiusSearch</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">);</span>

  <span class="c1">// Compute the features</span>
  <span class="n">fpfh</span><span class="p">.</span><span class="n">compute</span> <span class="p">(</span><span class="o">*</span><span class="n">fpfhs</span><span class="p">);</span>

  <span class="c1">// fpfhs-&gt;points.size () should have the same size as the input cloud-&gt;points.size ()*</span>
<span class="p">}</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The actual <strong>compute</strong> call from the <strong>FPFHEstimation</strong> class does nothing internally but:</p>
<div class="highlight-python"><pre>for each point p in cloud P

  1. pass 1:

     1. get the nearest neighbors of :math:`p`

     2. for each pair of :math:`p, p_k` (where :math:`p_k` is a neighbor of :math:`p`, compute the three angular values

     3. bin all the results in an output SPFH histogram

  2. pass 2:

     1. get the nearest neighbors of :math:`p`

     3. use each SPFH of :math:`p` with a weighting scheme to assemble the FPFH of :math:`p`:</pre>
</div>
</div>
<div class="section" id="speeding-fpfh-with-openmp">
<h1>Speeding FPFH with OpenMP</h1>
<p>For the speed-savvy users, PCL provides an additional implementation of FPFH
estimation which uses multi-core/multi-threaded paradigms using OpenMP to speed
the computation. The name of the class is <strong>pcl::FPFHEstimationOMP</strong>, and its
API is 100% compatible to the single-threaded <strong>pcl::FPFHEstimation</strong>, which
makes it suitable as a drop-in replacement. On a system with 8 cores, you
should get anything between 6-8 times faster computation times.</p>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
</div> <!-- #page-content -->

<div id="footer">

<div id="social-icons">
<a href="http://www.youtube.com/user/pointclouds" class="icon-youtube">Our Youtube channel</a>
<a href="https://plus.google.com/103977559850434700735?prsrc=1" class="icon-gplus">Google+</a>
<a href="http://www.facebook.com/pages/Point-Cloud-Library-PCL/157113581019354" class="icon-facebook">Facebook</a>
<a href="http://twitter.com/pointclouds" class="icon-twitter">Follow us on Twitter</a>
<a href="http://pointclouds.org/sitemap.html" id="footer-sitemap">Site map</a>
</div>

<p>
Except where otherwise noted, the PointClouds.org web pages are licensed under <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a>. 
</p>
</div> <!-- #footer -->

</div> <!-- #wrapper -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22031432-1']);
  _gaq.push(['_setDomainName', '.pointclouds.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


 
  
</body></html>
<!-- [^s^] [^t^] -->